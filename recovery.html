<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>darkOS Recovery</title>
<style>
body {
    background: #000;
    color: #0f0;
    font-family: monospace;
    margin: 0;
    padding: 0;
    height: 100vh;
    cursor: none; /* скрываем курсор */
    display: flex;
    justify-content: center;
    align-items: center;
}
#terminal {
    width: 90%;
    height: 90%;
    background: #000;
    border: 2px solid #0f0;
    padding: 10px;
    overflow-y: auto;
    white-space: pre-wrap;
    box-sizing: border-box;
}
</style>
</head>
<body>
<div id="terminal"></div>

<script>
const terminal = document.getElementById("terminal");

// Данные меню
const sections = [
  { name: "Восстановление", items: ["core.js", "shell.css"] },
  { name: "Функции", items: ["boot to darkOS", "Перезагрузка recovery"] }
];

let currentSection = 0;
let currentItem = 0;

// URL для реального скачивания
const urlMap = {
    "core.js": "https://raw.githubusercontent.com/smashgamer312/darkOS/main/system/core.js",
    "shell.css": "https://raw.githubusercontent.com/smashgamer312/darkOS/main/system/shell.css"
};

// Вывод меню
function renderMenu() {
  terminal.innerHTML = "";
  sections.forEach((section, si) => {
    terminal.innerHTML += `--- ${section.name} ---\n`;
    section.items.forEach((item, ii) => {
      const active = (si===currentSection && ii===currentItem) ? "[*]" : "[ ]";
      terminal.innerHTML += `${active} ${item}\n`;
    });
    terminal.innerHTML += "\n";
  });
  terminal.scrollTop = terminal.scrollHeight;
}

// Начальная отрисовка
renderMenu();

// Управление стрелками
document.addEventListener("keydown", e => {
  const items = sections[currentSection].items.length;
  if(e.key === "ArrowDown") currentItem = (currentItem+1)%items;
  if(e.key === "ArrowUp") currentItem = (currentItem-1+items)%items;
  if(e.key === "ArrowRight") { currentSection=(currentSection+1)%sections.length; currentItem=0; }
  if(e.key === "ArrowLeft") { currentSection=(currentSection-1+sections.length)%sections.length; currentItem=0; }
  if(e.key === "Enter") selectItem();
  renderMenu();
});

// Фейковое восстановление файла
function fakeRecovery(filename, callback) {
  const lines = [
    `Creating ${filename}...`,
    "Writing core functions...",
    "Initializing UI elements...",
    "Finalizing..."
  ];
  let i=0;
  const interval = setInterval(() => {
    if(i>=lines.length) { clearInterval(interval); callback && callback(); return; }
    terminal.innerHTML += lines[i] + "\n";
    terminal.scrollTop = terminal.scrollHeight;
    i++;
  }, 600);
}

// Скачивание файла с GitHub
function fetchAndDownload(url, filename) {
    fetch(url)
        .then(res => {
            if(!res.ok) throw new Error("Ошибка загрузки");
            return res.blob();
        })
        .then(blob => {
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.click();
            URL.revokeObjectURL(a.href);
            terminal.innerHTML += `${filename} успешно скачан!\n\n`;
        })
        .catch(err => {
            terminal.innerHTML += `Ошибка: ${err.message}\n\n`;
        });
}

// Выполнение выбранного пункта
function selectItem() {
  const item = sections[currentSection].items[currentItem];
  if(item === "core.js" || item === "shell.css") {
      terminal.innerHTML += `\nВосстанавливаем ${item}...\n`;
      fakeRecovery(item, () => fetchAndDownload(urlMap[item], item));
  } else if(item === "boot to darkOS") {
      terminal.innerHTML += "\nЗагрузка darkOS...\n";
      setTimeout(()=>location.href="main.html", 500);
  } else if(item === "Перезагрузка recovery") {
      terminal.innerHTML += "\nПерезагрузка recovery...\n";
      setTimeout(()=>location.reload(), 500);
  }
}
</script>
</body>
</html>

