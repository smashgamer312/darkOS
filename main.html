<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>dark.os</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>

const ERROR_CODE = "874v5t7q684ntv5796q43ynv57qn4hvu";

function showCriticalError(file) {
  document.documentElement.innerHTML = `
    <head>
      <title>Critical Error</title>
      <style>
        body {
          margin: 0;
          background: #000;
          color: #0a84ff;
          font-family: Segoe UI, sans-serif;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          text-align: center;
        }
        code { color: #fff }
      </style>
    </head>
    <body>
      <div>
        <h1>:(</h1>
        <p>–í —Å–∏—Å—Ç–µ–º–µ DarkOS –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</p>
        <p><b>–ö–æ–¥ –æ—à–∏–±–∫–∏:</b></p>
        <code>${ERROR_CODE}</code>
        <p style="margin-top:15px">
          –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª:<br>
          <b>${file}</b>
        </p>
        <p style="opacity:.6;margin-top:20px">
          –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
        </p>
      </div>
    </body>
  `;
}
</script>

<script>
// –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–∞–∂–µ –ø—Ä–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
(function(){
  const SECRET = 'admin-admin_admin!';

  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–æ–ª—å (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏)
  window.unlock_passwordView = function(){ return SECRET; };

  // –ö–æ—Ä–æ—Ç–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑–≤–∞—Ç—å unlock(admin_pass)
  window.admin_pass = SECRET;

  // –§—É–Ω–∫—Ü–∏—è unlock(password) ‚Äî –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Å–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
  window.unlock = function(pwd){
    try {
      const attempt = (typeof pwd === 'string') ? pwd : String(pwd);
      if (attempt === SECRET) {
        localStorage.removeItem('darkOS_system_locked'); location.reload();
        return 'UNLOCKED';
      }
      return 'INVALID_PASSWORD';
    } catch(e) { return 'ERROR'; }
  };
})();
</script>

<script>
// –ö–æ–Ω—Ç—Ä–æ–ª—å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è core.js –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ NEW GAME
// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é core_ignore = false. –ï—Å–ª–∏ true ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ `system/core.js` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
// –°—á–∏—Ç—ã–≤–∞–µ–º persistent-—Ñ–ª–∞–≥ –∏–∑ localStorage, —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
try {
  window.core_ignore = localStorage.getItem('darkOS_core_ignore') === 'true';
} catch(e) {
  window.core_ignore = false;
}

// –ï—Å–ª–∏ —Ñ–ª–∞–≥ —É–∂–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–π —ç–∫—Ä–∞–Ω —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É core.js
function showCoreIgnoredStartup(){
  document.documentElement.innerHTML = `
    <head>
      <title>Core Ignored (Startup)</title>
      <style>
        body { margin:0;background:#0b0b0b;color:#ffcc00;font-family:Courier, monospace;height:100vh;display:flex;align-items:center;justify-content:center; }
        .box { max-width:720px;padding:24px;border:2px solid #444;border-radius:8px;background:#111; }
        h1 { margin:0 0 12px 0;color:#ff6666 }
        p { margin:8px 0;opacity:0.9 }
        code { background:#000;padding:4px 6px;border-radius:4px;color:#0ff }
      </style>
    </head>
    <body>
      <div class="box">
        <h1>Core Error</h1>
        <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —è–¥—Ä–∞ —Å–∏—Å—Ç–µ–º—ã <b>system/core.js</b>.</p>
        <p>–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.</p>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –≤ —Ä–µ–∂–∏–º–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.</p>
        <p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–±–µ—Ä–∏—Ç–µ –≤ –º–µ–Ω—é —Ñ—É–Ω–∫—Ü–∏—é <code>boot to darkOS</code> –∏ –Ω–∞–∂–º–∏—Ç–µ Enter.</p>
        <p>–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ recovery –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
        <p>–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤—Å—ë –µ—â—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –≤ Telegram: <a href="https://t.me/darkos_support_bot" style="color:#0ff;text-decoration:none;">@darkos_support</a></p>
      </div>
    </body>
  `;
}
</script>

<script>

// === DRIVE API –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ ===
window.driveAPI = {
    zIndex: 1000, // –Ω–∞—á–∞–ª—å–Ω—ã–π z-index –¥–ª—è –æ–∫–æ–Ω –¥—Ä–∞–π–≤–µ—Ä–æ–≤

    log: function(msg) {
        console.log("[driveAPI]", msg);
    },

    createWindow: function(title, content, width = 300, height = 200) {
        const win = document.createElement("div");
        win.className = "window";
        win.style.position = "absolute";
        win.style.left = "100px";
        win.style.top = "100px";
        win.style.width = width + "px";
        win.style.height = height + "px";
        win.style.zIndex = ++this.zIndex;
        win.style.background = "#222";
        win.style.color = "#fff";
        win.style.border = "1px solid #555";
        win.style.display = "flex";
        win.style.flexDirection = "column";

        // —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–∫–Ω–∞
        win.innerHTML = `
            <div class="window-header" style="cursor:move; background:#444; padding:5px; display:flex; justify-content:space-between;">
                <span>${title}</span>
                <span class="close" style="cursor:pointer;">‚úñ</span>
            </div>
            <div class="window-content" style="flex:1; padding:5px; overflow:auto;">
                ${content}
            </div>
        `;

        // –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
        const closeBtn = win.querySelector(".close");
        closeBtn.onclick = () => win.remove();

        // –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
        const header = win.querySelector(".window-header");
        let drag = false, offsetX = 0, offsetY = 0;

        header.onmousedown = (e) => {
            drag = true;
            offsetX = e.clientX - win.offsetLeft;
            offsetY = e.clientY - win.offsetTop;
            this.zIndex++;
            win.style.zIndex = this.zIndex;
        };

        document.onmousemove = (e) => {
            if (!drag) return;
            win.style.left = (e.clientX - offsetX) + "px";
            win.style.top = (e.clientY - offsetY) + "px";
        };

        document.onmouseup = () => { drag = false; };

        // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª
        const desktop = document.getElementById("desktop");
        if (desktop) desktop.appendChild(win);

        return win;
    }
};

</script>

<script>
/* === –ó–ê–ì–†–£–ó–ö–ê CSS === */
function loadCSS(href) {
  return new Promise((resolve, reject) => {
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = href;
    link.onload = resolve;
    link.onerror = () => reject(href);
    document.head.appendChild(link);
  });
}

/* === –ó–ê–ì–†–£–ó–ö–ê JS === */
function loadJS(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = src;
    script.defer = true;
    script.onload = resolve;
    script.onerror = () => reject(src);
    document.body.appendChild(script);
  });
}

/* === –ü–†–û–í–ï–†–ö–ê –ë–õ–û–ö–ò–†–û–í–ö–ò –°–ò–°–¢–ï–ú–´ === */
function checkSystemLocked() {
  try {
    const locked = localStorage.getItem('darkOS_system_locked') === 'true';
    if (locked) {
      return true;
    }
  } catch(e) {}
  return false;
}

function showLockedScreen() {
  // –û—Ç–∫–ª—é—á–∞–µ–º –∑–≤—É–∫–∏ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
  if (window.soundsEnabled !== undefined) {
    window.soundsEnabled = false;
  }
  
  const html = `
    <head>
      <title>System Locked</title>
      <style>
        body {
          margin: 0;
          background: #1a1a1a;
          color: #fff;
          font-family: 'Courier New', monospace;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          padding: 20px;
        }
        .locked-container {
          max-width: 600px;
        }
        .locked-icon {
          font-size: 80px;
          margin-bottom: 20px;
        }
        h1 {
          font-size: 32px;
          margin: 0 0 10px 0;
          color: #ff4444;
        }
        p {
          margin: 10px 0;
          opacity: 0.8;
          line-height: 1.6;
        }
        .info-box {
          background: rgba(255, 68, 68, 0.1);
          border: 2px solid #ff4444;
          padding: 15px;
          border-radius: 5px;
          margin: 20px 0;
          font-size: 14px;
        }
        .recovery-hint {
          background: rgba(68, 255, 68, 0.1);
          border: 2px solid #44ff44;
          padding: 15px;
          border-radius: 5px;
          margin-top: 20px;
        }
        .recovery-hint b {
          color: #44ff44;
        }
        code {
          background: rgba(0,0,0,0.5);
          padding: 2px 6px;
          border-radius: 3px;
          color: #0ff;
        }
      </style>
    </head>
    <body>
      <div class="locked-container">
        <div class="locked-icon">üîí</div>
        <h1>–°–ò–°–¢–ï–ú–ê –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê</h1>
        <p>DarkOS –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∞ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏</p>
        
        <div class="info-box">
          <p>–°—Ç–∞—Ç—É—Å: <b>LOCKED</b></p>
          <p>–ü—Ä–∏—á–∏–Ω–∞: System triggered fatal error</p>
          <p>–ö–æ–¥: 0xDEADBEEF</p>
        </div>
        
        <p>–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏ —Ç—Ä–µ–±—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
        </div>
      </div>
    </body>
  `;
  
  document.documentElement.innerHTML = html;
  
  // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–º –ø—É–≥–∞—é—â–∏–π –∑–≤—É–∫ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
  try {
    const audio = new Audio('system/sounds/ling.mp3');
    audio.volume = 0.8;
    audio.play().catch(() => {
      // –ï—Å–ª–∏ mp3 –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º Web Audio API
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const now = audioContext.currentTime;
        
        const frequencies = [100, 150, 80, 120, 100];
        let offset = 0;
        
        frequencies.forEach((freq) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          
          osc.connect(gain);
          gain.connect(audioContext.destination);
          
          osc.frequency.value = freq;
          osc.type = 'square';
          
          const startTime = now + offset;
          gain.gain.setValueAtTime(0.2, startTime);
          gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);
          
          osc.start(startTime);
          osc.stop(startTime + 0.4);
          
          offset += 0.45;
        });
      } catch(e) {}
    });
  } catch(e) {}
}

/* === –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ === */
(async () => {
  // –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω persistent-—Ñ–ª–∞–≥ –∏–≥–Ω–æ—Ä–∞ core.js ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∏ –Ω–µ –≥—Ä—É–∑–∏–º core
  try {
    if (window.core_ignore) {
      showCoreIgnoredStartup();
      return;
    }
  } catch(e) {}

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞
  if (checkSystemLocked()) {
    showLockedScreen();
    return;
  }
  
  try {
    await loadCSS("system/shell.css");
    await loadJS("system/core.js");
  } catch (file) {
    showCriticalError(file);
  }
})();
</script>

</head>
<body>

<div id="nyGreeting" style="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:99999;font-size:2em;color:#fff;text-shadow:0 0 10px #0ff,0 0 20px #0ff;background:rgba(0,0,0,0.5);padding:10px 30px;border-radius:20px;display:none;"></div>

<style>
.snowflake {
  position: fixed;
  top: -40px;
  color: #fff;
  font-size: 2em;
  pointer-events: none;
  z-index: 99999;
  text-shadow: 0 0 8px #0ff, 0 0 16px #0ff;
}
</style>
<script>
let snowflakeInterval = null;
function createSnowflake() {
  const snow = document.createElement('div');
  snow.className = 'snowflake';
  snow.textContent = '‚ùÑ';
  snow.style.left = Math.random() * 100 + 'vw';
  snow.style.fontSize = (Math.random()*1.5+1) + 'em';
  document.body.appendChild(snow);
  let top = -40;
  const speed = Math.random()*2+1;
  const drift = (Math.random()-0.5)*2;
  function fall() {
    top += speed;
    snow.style.top = top + 'px';
    snow.style.left = 'calc(' + snow.style.left + ' + ' + drift + 'px)';
    if(top < window.innerHeight+40) requestAnimationFrame(fall);
    else snow.remove();
  }
  fall();
}
function startSnowflakes() {
  if(snowflakeInterval) return;
  snowflakeInterval = setInterval(createSnowflake, 400);
}
function stopSnowflakes() {
  clearInterval(snowflakeInterval);
  snowflakeInterval = null;
}
function clearSnowflakes() {
  document.querySelectorAll('.snowflake').forEach(e=>e.remove());
}
document.addEventListener('visibilitychange',()=>{
  if(document.hidden) {
    stopSnowflakes();
  } else {
    clearSnowflakes();
    startSnowflakes();
  }
});
startSnowflakes();
window.addEventListener('DOMContentLoaded',()=>{
  setTimeout(()=>{
    document.getElementById('nyGreeting').style.display = 'block';
    setTimeout(()=>{
      document.getElementById('nyGreeting').style.display = 'none';
    }, 7000);
  }, 2000);
});
</script>
<div id="boot">
  <div class="boot-center">
    <div class="loader"></div>
    <p>DarkOS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
  </div>
</div>

<div id="system" class="hidden">
  <div id="desktop"></div>

  <div id="taskbar">
    <button id="start">–ü—É—Å–∫</button>
  </div>

  <div id="startMenu">
    <p>üåü DarkOS</p>
    <button id="openAppBtn">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
  </div>
</div>

<div id="loadingOverlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: monospace;
    font-size: 24px;
    opacity: 1;
    transition: opacity 0.5s;
    z-index: 9999;
">
    by darklight
</div>

<script>
    const overlay = document.getElementById("loadingOverlay");

    setTimeout(() => {
        overlay.style.opacity = "0"; // –ø–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
        setTimeout(() => {
            overlay.remove(); // —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        }, 250); // –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å transition
    }, 500); // —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã —Å–∫—Ä—ã–≤–∞–µ–º
</script>

<script>
  function restoreOS() {
  const keywords = ['Generating filesystem', 'Downloading file', 'Reseting', 'Waiting for a core', 'Waiting', 'Setuping file', 'Starting', 'Checking'];
  let messages = [];
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –∫–ª—é—á–µ–≤–æ—Ä–¥–∞–º–∏
  for (let i = 0; i < 40; i++) {
    const randomKeyword = keywords[Math.floor(Math.random() * keywords.length)];
    const randomPercent = Math.floor(Math.random() * 100);
    messages.push(`${randomKeyword}... ${randomPercent}%`);
  }
  
  // –í—ã–≤–æ–¥–∏–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
  let index = 0;
  const outputMessages = () => {
    if (index < messages.length) {
      console.log(messages[index]);
      index++;
      setTimeout(outputMessages, Math.random() * 1500 + 200);
    } else {
      // –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–≤–µ–¥–µ–Ω—ã, —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
      console.log('Done! Restarting in 5 seconds.');
      let countdown = 5;
      const countdownInterval = setInterval(() => {
        if (countdown > 0) {
          console.log(`Restarting in ${countdown}...`);
          countdown--;
        } else {
          clearInterval(countdownInterval);
          // –û—á–∏—â–∞–µ–º localStorage –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º
          try {
            localStorage.clear();
            localStorage.setItem('darkOS_activated', 'true');
          } catch(e) {}
          location.reload();
        }
      }, 1000);
    }
  };
  
  console.clear();
  console.log('Starting system restore...');
  setTimeout(outputMessages, 500);
}
</script>

</body>
</html>