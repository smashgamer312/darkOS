<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>dark.os</title>
<audio id="bootSound" src="system/sounds/boot.mp3" preload="auto"></audio>


<script>

const ERROR_CODE = "874v5t7q684ntv5796q43ynv57qn4hvu";

function showCriticalError(file) {
  document.documentElement.innerHTML = `
    <head>
      <title>Critical Error</title>
      <style>
        body {
          margin: 0;
          background: #000;
          color: #0a84ff;
          font-family: Segoe UI, sans-serif;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          text-align: center;
        }
        code { color: #fff }
      </style>
    </head>
    <body>
      <div>
        <h1>:(</h1>
        <p>–í —Å–∏—Å—Ç–µ–º–µ DarkOS –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</p>
        <p><b>–ö–æ–¥ –æ—à–∏–±–∫–∏:</b></p>
        <code>${ERROR_CODE}</code>
        <p style="margin-top:15px">
          –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª:<br>
          <b>${file}</b>
        </p>
        <p style="opacity:.6;margin-top:20px">
          –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
        </p>
      </div>
    </body>
  `;
}
</script>

<script>

// === DRIVE API –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ ===
window.driveAPI = {
    zIndex: 1000, // –Ω–∞—á–∞–ª—å–Ω—ã–π z-index –¥–ª—è –æ–∫–æ–Ω –¥—Ä–∞–π–≤–µ—Ä–æ–≤

    log: function(msg) {
        console.log("[driveAPI]", msg);
    },

    createWindow: function(title, content, width = 300, height = 200) {
        const win = document.createElement("div");
        win.className = "window";
        win.style.position = "absolute";
        win.style.left = "100px";
        win.style.top = "100px";
        win.style.width = width + "px";
        win.style.height = height + "px";
        win.style.zIndex = ++this.zIndex;
        win.style.background = "#222";
        win.style.color = "#fff";
        win.style.border = "1px solid #555";
        win.style.display = "flex";
        win.style.flexDirection = "column";

        // —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–∫–Ω–∞
        win.innerHTML = `
            <div class="window-header" style="cursor:move; background:#444; padding:5px; display:flex; justify-content:space-between;">
                <span>${title}</span>
                <span class="close" style="cursor:pointer;">‚úñ</span>
            </div>
            <div class="window-content" style="flex:1; padding:5px; overflow:auto;">
                ${content}
            </div>
        `;

        // –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
        const closeBtn = win.querySelector(".close");
        closeBtn.onclick = () => win.remove();

        // –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
        const header = win.querySelector(".window-header");
        let drag = false, offsetX = 0, offsetY = 0;

        header.onmousedown = (e) => {
            drag = true;
            offsetX = e.clientX - win.offsetLeft;
            offsetY = e.clientY - win.offsetTop;
            this.zIndex++;
            win.style.zIndex = this.zIndex;
        };

        document.onmousemove = (e) => {
            if (!drag) return;
            win.style.left = (e.clientX - offsetX) + "px";
            win.style.top = (e.clientY - offsetY) + "px";
        };

        document.onmouseup = () => { drag = false; };

        // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª
        const desktop = document.getElementById("desktop");
        if (desktop) desktop.appendChild(win);

        return win;
    }
};

</script>

<script>
/* === –ó–ê–ì–†–£–ó–ö–ê CSS === */
function loadCSS(href) {
  return new Promise((resolve, reject) => {
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = href;
    link.onload = resolve;
    link.onerror = () => reject(href);
    document.head.appendChild(link);
  });
}

/* === –ó–ê–ì–†–£–ó–ö–ê JS === */
function loadJS(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = src;
    script.defer = true;
    script.onload = resolve;
    script.onerror = () => reject(src);
    document.body.appendChild(script);
  });
}

/* === –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ === */
(async () => {
  try {
    await loadCSS("system/shell.css");
    await loadJS("system/core.js");
  } catch (file) {
    showCriticalError(file);
  }
})();
</script>

</head>
<body>

<!-- BOOT -->
<div id="boot">
  <div class="boot-center">
    <div class="loader"></div>
    <p>DarkOS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
  </div>
</div>

<!-- SYSTEM -->
<div id="system" class="hidden">
  <div id="desktop"></div>

  <div id="taskbar">
    <button id="start">–ü—É—Å–∫</button>
  </div>

  <div id="startMenu">
    <p>üåü DarkOS</p>
    <button id="openAppBtn">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
  </div>
</div>

<div id="loadingOverlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: monospace;
    font-size: 24px;
    opacity: 1;
    transition: opacity 0.5s;
    z-index: 9999;
">
    Loading libs...
    Waiting for core signal..
</div>

<script>
    const overlay = document.getElementById("loadingOverlay");

    setTimeout(() => {
        overlay.style.opacity = "0"; // –ø–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
        setTimeout(() => {
            overlay.remove(); // —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        }, 250); // –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å transition
    }, 500); // —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã —Å–∫—Ä—ã–≤–∞–µ–º
</script>

</body>
</html>

